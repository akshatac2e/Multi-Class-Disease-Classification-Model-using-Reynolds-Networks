# ğŸ—ï¸ Complete End-to-End Architecture Diagram

## Blood Cell Analysis System - Full Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATA PREPARATION PHASE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raw Datasets    â”‚
â”‚  â€¢ BCCD (360)    â”‚â”€â”€â”
â”‚  â€¢ Kaggle (364)  â”‚  â”‚
â”‚  â€¢ LISC (400+)   â”‚  â”œâ”€â”€â–º prepare_segmentation_data.py
â”‚  â€¢ ALL-IDB (368) â”‚  â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”œâ”€â–º Parse XML annotations (Pascal VOC)
                      â”‚    â”œâ”€â–º Convert BBox â†’ Segmentation Masks
                      â”‚    â”‚   (Elliptical shapes for biological accuracy)
                      â”‚    â”œâ”€â–º Apply Augmentation (3-5Ã—)
                      â”‚    â”‚   â€¢ Rotation (360Â°)
                      â”‚    â”‚   â€¢ Flips (H/V)
                      â”‚    â”‚   â€¢ Brightness (0.7-1.3Ã—)
                      â”‚    â”‚   â€¢ Elastic deformations
                      â”‚    â”‚
                      â”‚    â–¼
                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  â”‚ Prepared Dataset        â”‚
                      â”‚  â”‚ â€¢ images/ (1,080+)      â”‚
                      â”‚  â”‚ â€¢ masks/ (RGB format)   â”‚
                      â”‚  â”‚   - R: Background       â”‚
                      â”‚  â”‚   - G: RBC regions      â”‚
                      â”‚  â”‚   - B: WBC regions      â”‚
                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            TRAINING PHASE                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MODEL 1: SEGMENTATION MODEL                                â”‚
â”‚                          (U-Net + Reynolds Networks)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: Raw Microscopy Image (512Ã—512Ã—3)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stain Normalization     â”‚ â—„â”€â”€â”€ Handles different staining methods
â”‚ â€¢ Optical Density       â”‚      (Giemsa, Wright, Leishman, H&E)
â”‚ â€¢ Learnable Stain Matrixâ”‚
â”‚ â€¢ Color Space Transform â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    U-Net Encoder                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Conv2D â”‚   â”‚ Conv2D â”‚   â”‚ Conv2D â”‚   â”‚ Conv2D â”‚            â”‚
â”‚  â”‚  64    â”‚â”€â–ºâ”‚  128   â”‚â”€â–ºâ”‚  256   â”‚â”€â–ºâ”‚  512   â”‚            â”‚
â”‚  â”‚â†“Pool2D â”‚   â”‚â†“Pool2D â”‚   â”‚â†“Pool2D â”‚   â”‚â†“Pool2D â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Bottleneck with Reynolds                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Conv2D(1024) â†’ Reshape to (batch, n, 1024)             â”‚     â”‚
â”‚  â”‚        â†“                                                â”‚     â”‚
â”‚  â”‚ EfficientReynoldsFeatureOperator                        â”‚     â”‚
â”‚  â”‚   â€¢ Dimension reduction: 1024 â†’ 256                     â”‚     â”‚
â”‚  â”‚   â€¢ Cyclic transpositions: O(n) complexity              â”‚     â”‚
â”‚  â”‚   â€¢ Permutation invariance: f(SÏ€) = f(S)               â”‚     â”‚
â”‚  â”‚        â†“                                                â”‚     â”‚
â”‚  â”‚ FeatureAttention (Multi-head, 4 heads)                  â”‚     â”‚
â”‚  â”‚   â€¢ Self-attention on Reynolds features                 â”‚     â”‚
â”‚  â”‚   â€¢ Key dim: 256/4 = 64                                 â”‚     â”‚
â”‚  â”‚        â†“                                                â”‚     â”‚
â”‚  â”‚ Dense(1024) â†’ Reshape back to (batch, H, W, 1024)      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    U-Net Decoder                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚UpConv  â”‚   â”‚UpConv  â”‚   â”‚UpConv  â”‚   â”‚UpConv  â”‚            â”‚
â”‚  â”‚  512   â”‚â—„â”€â–ºâ”‚  256   â”‚â—„â”€â–ºâ”‚  128   â”‚â—„â”€â–ºâ”‚  64    â”‚            â”‚
â”‚  â”‚+ Skip  â”‚   â”‚+ Skip  â”‚   â”‚+ Skip  â”‚   â”‚+ Skip  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Output: Segmentation Mask (512Ã—512Ã—3)
    â€¢ Channel 0: Background probability
    â€¢ Channel 1: RBC probability
    â€¢ Channel 2: WBC probability

Training Details:
â”œâ”€ Loss: Categorical Crossentropy
â”œâ”€ Optimizer: Adam (lr=1e-4)
â”œâ”€ Metrics: Accuracy, MeanIoU
â”œâ”€ Callbacks: EarlyStopping, ReduceLROnPlateau, ModelCheckpoint
â”œâ”€ Expected IoU: 0.80-0.88 (BCCD + augmentation)
â””â”€ Training Time: 2-3 hours (balanced preset)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL 2: RBC CLASSIFIER                                        â”‚
â”‚                    (Reynolds Networks + Domain Adaptation)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: Cropped RBC Cell (130Ã—130Ã—3)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stain Normalization     â”‚ â—„â”€â”€â”€ Same layer, ensures consistency
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CNN Backbone (ResNet-style)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Conv2D(64, 7Ã—7, stride=2) + BN + ReLU                    â”‚    â”‚
â”‚  â”‚         â†“                                                 â”‚    â”‚
â”‚  â”‚ MaxPool2D(3Ã—3, stride=2)                                 â”‚    â”‚
â”‚  â”‚         â†“                                                 â”‚    â”‚
â”‚  â”‚ [Block1] Conv2D(64) Ã— 2 (with residual)                  â”‚    â”‚
â”‚  â”‚ [Block2] Conv2D(128) Ã— 2 (stride=2 on first)             â”‚    â”‚
â”‚  â”‚ [Block3] Conv2D(256) Ã— 2 (stride=2 on first)             â”‚    â”‚
â”‚  â”‚         â†“                                                 â”‚    â”‚
â”‚  â”‚ Conv2D(512, 3Ã—3) + BN + ReLU                             â”‚    â”‚
â”‚  â”‚         â†“                                                 â”‚    â”‚
â”‚  â”‚ Feature Maps: (batch, H', W', 512)                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Reynolds Feature Processing                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Reshape to (batch, n, 512) where n = H'Ã—W'              â”‚    â”‚
â”‚  â”‚         â†“                                                â”‚    â”‚
â”‚  â”‚ EfficientReynoldsFeatureOperator(512 â†’ 64)              â”‚    â”‚
â”‚  â”‚   â€¢ Cyclic transpositions across spatial features       â”‚    â”‚
â”‚  â”‚   â€¢ Permutation-invariant representation                â”‚    â”‚
â”‚  â”‚         â†“                                                â”‚    â”‚
â”‚  â”‚ FeatureAttention(d_model=64, num_heads=4)               â”‚    â”‚
â”‚  â”‚   â€¢ Refines Reynolds features                           â”‚    â”‚
â”‚  â”‚         â†“                                                â”‚    â”‚
â”‚  â”‚ AdaptiveSetAggregation(output_dim=512)                  â”‚    â”‚
â”‚  â”‚   â€¢ Weighted sum (learnable weights)                    â”‚    â”‚
â”‚  â”‚   â€¢ Max pooling                                          â”‚    â”‚
â”‚  â”‚   â€¢ Mean pooling                                         â”‚    â”‚
â”‚  â”‚   â€¢ Concatenate â†’ Dense(512)                            â”‚    â”‚
â”‚  â”‚         â†“                                                â”‚    â”‚
â”‚  â”‚ Global Features: (batch, 512)                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚                       â”‚
    â–¼                      â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Classification â”‚  â”‚ Domain Adaptation   â”‚  â”‚  Dropout     â”‚
â”‚    Head       â”‚  â”‚    Branch           â”‚  â”‚   (0.5)      â”‚
â”‚               â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚      â†“       â”‚
â”‚               â”‚  â”‚ â”‚Gradient Reversalâ”‚ â”‚  â”‚  Dense(256)  â”‚
â”‚               â”‚  â”‚ â”‚Layer (Î»=0.1)    â”‚ â”‚  â”‚   ReLU       â”‚
â”‚               â”‚  â”‚ â”‚     â†“           â”‚ â”‚  â”‚      â†“       â”‚
â”‚               â”‚  â”‚ â”‚Dense(128, ReLU) â”‚ â”‚  â”‚  Dropout     â”‚
â”‚               â”‚  â”‚ â”‚     â†“           â”‚ â”‚  â”‚   (0.3)      â”‚
â”‚               â”‚  â”‚ â”‚Dense(1, sigmoid)â”‚ â”‚  â”‚      â†“       â”‚
â”‚               â”‚  â”‚ â”‚     â†“           â”‚ â”‚  â”‚  Dense(3)    â”‚
â”‚               â”‚  â”‚ â”‚Domain Label     â”‚ â”‚  â”‚  softmax     â”‚
â”‚               â”‚  â”‚ â”‚(0=source/1=tgt) â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚               â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â”‚          â”‚                       â”‚
â”‚               â”‚          â–¼                       â–¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Domain Loss (Binary)    Class Loss (Categorical)
                   (weight=0.1)            (weight=1.0)

Output: 3 Classes
    â€¢ healthy_RBC
    â€¢ malaria_RBC
    â€¢ sickle_RBC

Training Details:
â”œâ”€ Multi-task Learning (Classification + Domain Adaptation)
â”œâ”€ Loss Weights: Class=1.0, Domain=0.1
â”œâ”€ Class Weights: Balanced (handles imbalanced data)
â”œâ”€ Optimizer: Adam (lr=1e-4)
â””â”€ Expected Accuracy: 90-95% (with good data)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL 3: WBC CLASSIFIER                                        â”‚
â”‚                    (Same architecture as RBC Classifier)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: Cropped WBC Cell (130Ã—130Ã—3)
    â”‚
    â”‚  [Same architecture as RBC Classifier]
    â”‚  â€¢ Stain Normalization
    â”‚  â€¢ CNN Backbone (ResNet-style)
    â”‚  â€¢ Reynolds Feature Processing
    â”‚  â€¢ Feature Attention
    â”‚  â€¢ Adaptive Set Aggregation
    â”‚  â€¢ Domain Adaptation Branch
    â”‚  â€¢ Classification Head
    â”‚
    â–¼
Output: 2 Classes
    â€¢ healthy_WBC
    â€¢ leukemia_WBC (cancer)

Training Details: Same as RBC Classifier


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           INFERENCE PHASE                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COMPLETE END-TO-END PIPELINE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: Raw Microscopy Image (any size)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Load & Preprocess                                       â”‚
â”‚  â€¢ Read image (PNG/JPG/TIFF)                                    â”‚
â”‚  â€¢ Convert to float32 [0, 1]                                    â”‚
â”‚  â€¢ Store original size                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Segmentation                                            â”‚
â”‚  â€¢ Resize to (512, 512)                                         â”‚
â”‚  â€¢ Run Segmentation Model                                       â”‚
â”‚  â€¢ Get mask (512, 512, 3)                                       â”‚
â”‚  â€¢ Resize mask back to original size                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Cell Extraction                                         â”‚
â”‚  â€¢ Convert mask to class labels (argmax)                        â”‚
â”‚  â€¢ Find connected components (RBC regions)                      â”‚
â”‚  â€¢ Find connected components (WBC regions)                      â”‚
â”‚  â€¢ Filter by area (100 < area < 10,000)                         â”‚
â”‚  â€¢ Extract bounding boxes with padding                          â”‚
â”‚  â€¢ Crop individual cells                                        â”‚
â”‚  â€¢ Resize to (130, 130)                                         â”‚
â”‚                                                                  â”‚
â”‚  Output:                                                         â”‚
â”‚    cell_images: List[np.ndarray]                                â”‚
â”‚    cell_types: List[int] (1=RBC, 2=WBC)                         â”‚
â”‚    cell_bboxes: List[Tuple[x1, y1, x2, y2]]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚                    â”‚
    â–¼                      â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RBC Cells    â”‚   â”‚ WBC Cells    â”‚   â”‚              â”‚
â”‚ (batch)      â”‚   â”‚ (batch)      â”‚   â”‚              â”‚
â”‚      â†“       â”‚   â”‚      â†“       â”‚   â”‚              â”‚
â”‚ RBC Model    â”‚   â”‚ WBC Model    â”‚   â”‚              â”‚
â”‚      â†“       â”‚   â”‚      â†“       â”‚   â”‚              â”‚
â”‚ Predictions  â”‚   â”‚ Predictions  â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Aggregate Results                                       â”‚
â”‚  For each cell:                                                 â”‚
â”‚    â€¢ Get predicted class (argmax)                               â”‚
â”‚    â€¢ Get confidence score                                       â”‚
â”‚    â€¢ Create CellDetection object:                               â”‚
â”‚        - cell_id                                                â”‚
â”‚        - cell_type (RBC/WBC)                                    â”‚
â”‚        - bbox coordinates                                       â”‚
â”‚        - disease_class                                          â”‚
â”‚        - confidence                                             â”‚
â”‚        - centroid                                               â”‚
â”‚    â€¢ Flag uncertain cases (confidence < threshold + margin)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Generate Diagnostic Report                              â”‚
â”‚  Summary Statistics:                                            â”‚
â”‚    â€¢ Total cells detected                                       â”‚
â”‚    â€¢ RBC count, WBC count                                       â”‚
â”‚    â€¢ RBC breakdown: healthy/malaria/sickle                      â”‚
â”‚    â€¢ WBC breakdown: healthy/leukemia                            â”‚
â”‚    â€¢ Infection rates                                            â”‚
â”‚                                                                  â”‚
â”‚  Detailed Results:                                              â”‚
â”‚    â€¢ List of all CellDetection objects                          â”‚
â”‚    â€¢ Uncertain cases flagged                                    â”‚
â”‚                                                                  â”‚
â”‚  Outputs:                                                        â”‚
â”‚    â€¢ JSON report (machine-readable)                             â”‚
â”‚    â€¢ Text summary (human-readable)                              â”‚
â”‚    â€¢ Annotated image (visualization)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Save Results                                             â”‚
â”‚  â€¢ {image_name}_annotated.png                                    â”‚
â”‚    - Bounding boxes colored by disease                           â”‚
â”‚    - Labels with confidence scores                               â”‚
â”‚  â€¢ {image_name}_report.json                                      â”‚
â”‚    - Complete machine-readable report                            â”‚
â”‚  â€¢ {image_name}_summary.txt                                      â”‚
â”‚    - Human-readable summary                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Final Output: DiagnosticReport
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BLOOD CELL ANALYSIS REPORT                                       â”‚
â”‚ ================================================================ â”‚
â”‚                                                                  â”‚
â”‚ OVERALL STATISTICS:                                              â”‚
â”‚   Total Cells: 847                                               â”‚
â”‚   - RBCs: 790                                                    â”‚
â”‚   - WBCs: 57                                                     â”‚
â”‚                                                                  â”‚
â”‚ RED BLOOD CELL ANALYSIS:                                         â”‚
â”‚   Healthy: 765 (96.8%)                                           â”‚
â”‚   Malaria: 18 (2.3%)                                             â”‚
â”‚   Sickle Cell: 7 (0.9%)                                          â”‚
â”‚   Infection Rate: 3.2%                                           â”‚
â”‚                                                                  â”‚
â”‚ WHITE BLOOD CELL ANALYSIS:                                       â”‚
â”‚   Healthy: 54 (94.7%)                                            â”‚
â”‚   Leukemia: 3 (5.3%)                                             â”‚
â”‚   Cancer Rate: 5.3%                                              â”‚
â”‚                                                                  â”‚
â”‚ UNCERTAIN CASES: 12 cells flagged for manual review              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KEY ARCHITECTURAL COMPONENTS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Reynolds Networks Core (Theorem 3 - Cyclic Transpositions)   â”‚
â”‚                                                                  â”‚
â”‚   Given set S = {xâ‚, xâ‚‚, ..., xâ‚™}                               â”‚
â”‚                                                                  â”‚
â”‚   Instead of averaging over ALL permutations (n!):              â”‚
â”‚     f(S) = 1/n! âˆ‘_{Ï€âˆˆSâ‚™} f({x_{Ï€(1)}, ..., x_{Ï€(n)}})          â”‚
â”‚                                                                  â”‚
â”‚   Use CYCLIC permutations only (n):                             â”‚
â”‚     Ï„áµ¢(S) = {x_{i+1}, x_{i+2}, ..., xâ‚™, xâ‚, ..., xáµ¢}          â”‚
â”‚     f(S) â‰ˆ 1/n âˆ‘_{i=1}^n f(Ï„áµ¢(S))                              â”‚
â”‚                                                                  â”‚
â”‚   Complexity: O(n!) â†’ O(n) âœ“                                    â”‚
â”‚   Properties:                                                    â”‚
â”‚     â€¢ Permutation invariance preserved                          â”‚
â”‚     â€¢ Efficient computation via tf.roll()                       â”‚
â”‚     â€¢ Learnable weights on permutations                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Stain Normalization Layer                                     â”‚
â”‚                                                                  â”‚
â”‚   Handles different staining protocols:                         â”‚
â”‚     â€¢ Giemsa (purple/pink)                                      â”‚
â”‚     â€¢ Wright (blue/red)                                         â”‚
â”‚     â€¢ Leishman (purple)                                         â”‚
â”‚     â€¢ H&E (hematoxylin & eosin)                                 â”‚
â”‚                                                                  â”‚
â”‚   Process:                                                       â”‚
â”‚     1. RGB â†’ Optical Density: OD = -log(RGB + Îµ)               â”‚
â”‚     2. Apply learnable stain matrix: OD' = OD Ã— M               â”‚
â”‚     3. Normalize: OD_norm = OD' Ã— Î³ + Î²                         â”‚
â”‚     4. Convert back: RGB' = exp(-OD_norm)                       â”‚
â”‚                                                                  â”‚
â”‚   Trainable Parameters:                                         â”‚
â”‚     â€¢ Stain matrix M (3Ã—3)                                      â”‚
â”‚     â€¢ Gamma Î³ (3,)                                              â”‚
â”‚     â€¢ Beta Î² (3,)                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Domain Adaptation (Gradient Reversal Layer)                  â”‚
â”‚                                                                  â”‚
â”‚   Purpose: Learn features that are:                             â”‚
â”‚     â€¢ Discriminative for disease classification                 â”‚
â”‚     â€¢ Invariant to domain (staining method/lab)                 â”‚
â”‚                                                                  â”‚
â”‚   Mechanism:                                                     â”‚
â”‚     Forward pass: x' = Î» Ã— x                                    â”‚
â”‚     Backward pass: âˆ‚L/âˆ‚x = -Î» Ã— âˆ‚L/âˆ‚x'                          â”‚
â”‚                                                                  â”‚
â”‚   During training:                                               â”‚
â”‚     â€¢ Feature extractor learns domain-invariant features        â”‚
â”‚     â€¢ Domain classifier tries to predict source/target          â”‚
â”‚     â€¢ Gradient reversal confuses domain classifier              â”‚
â”‚                                                                  â”‚
â”‚   Lambda (Î») = 0.1 (balances class vs domain loss)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Adaptive Set Aggregation                                      â”‚
â”‚                                                                  â”‚
â”‚   Combines multiple pooling strategies:                         â”‚
â”‚                                                                  â”‚
â”‚   Input: (batch, n, d) feature set                              â”‚
â”‚                                                                  â”‚
â”‚   1. Weighted Sum:                                               â”‚
â”‚      w = Ïƒ(MLP(x))  # Learnable attention weights               â”‚
â”‚      yâ‚ = âˆ‘áµ¢ wáµ¢xáµ¢                                               â”‚
â”‚                                                                  â”‚
â”‚   2. Max Pooling:                                                â”‚
â”‚      yâ‚‚ = max(xâ‚, xâ‚‚, ..., xâ‚™)                                  â”‚
â”‚                                                                  â”‚
â”‚   3. Mean Pooling:                                               â”‚
â”‚      yâ‚ƒ = (1/n) âˆ‘áµ¢ xáµ¢                                           â”‚
â”‚                                                                  â”‚
â”‚   4. Concatenate & Project:                                      â”‚
â”‚      y = Dense([yâ‚; yâ‚‚; yâ‚ƒ])                                    â”‚
â”‚                                                                  â”‚
â”‚   Benefits: Captures both discriminative & representative info  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Multi-Head Feature Attention                                  â”‚
â”‚                                                                  â”‚
â”‚   Applied after Reynolds operator for feature refinement        â”‚
â”‚                                                                  â”‚
â”‚   Architecture:                                                  â”‚
â”‚     â€¢ 4 attention heads                                         â”‚
â”‚     â€¢ Key dimension: d_model / num_heads                        â”‚
â”‚     â€¢ Self-attention: Attention(Q, K, V) where Q=K=V=features   â”‚
â”‚     â€¢ Residual connection + Layer Normalization                 â”‚
â”‚                                                                  â”‚
â”‚   Formula:                                                       â”‚
â”‚     Attention(Q,K,V) = softmax(QKáµ€/âˆšd_k)V                       â”‚
â”‚     MultiHead = Concat(headâ‚, ..., headâ‚„)W                      â”‚
â”‚     Output = LayerNorm(x + MultiHead)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA FLOW SUMMARY                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Microscope â”‚â”€â”€â”€â”€â–ºâ”‚   Dataset    â”‚â”€â”€â”€â”€â–ºâ”‚   Training    â”‚â”€â”€â”€â”€â–ºâ”‚   Trained    â”‚
â”‚   Images   â”‚     â”‚ Preparation  â”‚     â”‚   Pipeline    â”‚     â”‚   Models     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                     â”‚                      â”‚
                          â”‚                     â”‚                      â”‚
                          â–¼                     â–¼                      â–¼
                   prepare_seg      training_pipeline.py      segmentation_model.keras
                   _data.py         â”œâ”€ Segmentation           rbc_classifier.keras
                   â”‚                â”œâ”€ RBC Classifier         wbc_classifier.keras
                   â”‚                â””â”€ WBC Classifier
                   â”‚
                   â”œâ”€â–º Bounding boxes â†’ Segmentation masks
                   â”œâ”€â–º Augmentation (3-5Ã—)
                   â””â”€â–º Train/val split (80/20)

                                         [INFERENCE]
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   New      â”‚                                â–¼                 â”‚  Diagnostic  â”‚
â”‚ Microscopy â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  inference_pipeline.py  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    Report    â”‚
â”‚   Image    â”‚                       â”‚                          â”‚ â€¢ JSON       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚                          â”‚ â€¢ Text       â”‚
                                     â”‚                          â”‚ â€¢ Annotated  â”‚
                                     â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
                    â–¼                â–¼                â–¼
              Segmentation    RBC Classifier  WBC Classifier
                 Model             Model           Model


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PERFORMANCE METRICS                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Model 1: Segmentation
â”œâ”€ Metric: Mean IoU (Intersection over Union)
â”œâ”€ Expected: 0.80-0.88 (with BCCD + augmentation)
â”œâ”€ Training Time: 2-3 hours (balanced preset, GPU)
â””â”€ Parameters: ~23M

Model 2: RBC Classifier
â”œâ”€ Metric: Classification Accuracy
â”œâ”€ Expected: 90-95% (with good quality data)
â”œâ”€ Classes: 3 (healthy, malaria, sickle cell)
â”œâ”€ Training Time: 1-2 hours (balanced preset, GPU)
â””â”€ Parameters: ~5M

Model 3: WBC Classifier
â”œâ”€ Metric: Classification Accuracy
â”œâ”€ Expected: 90-95% (with good quality data)
â”œâ”€ Classes: 2 (healthy, leukemia)
â”œâ”€ Training Time: 1-2 hours (balanced preset, GPU)
â””â”€ Parameters: ~5M

End-to-End Pipeline
â”œâ”€ Latency: ~2-5 seconds per image (GPU)
â”œâ”€ Throughput: ~200-500 images/minute (batch processing)
â””â”€ Memory: ~4-6 GB GPU RAM


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CONFIGURATION & PRESETS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Training Presets (config/training_presets.yaml):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preset   â”‚ d_reduced  â”‚ Time (GPU)   â”‚ Accuracy    â”‚ Use Case    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ fast     â”‚     32     â”‚   3 hours    â”‚   85-88%    â”‚ Quick test  â”‚
â”‚ balanced â”‚     64     â”‚  13 hours    â”‚   90-93%    â”‚ Production  â”‚
â”‚ accurate â”‚    128     â”‚  25 hours    â”‚   92-95%    â”‚ High acc.   â”‚
â”‚ research â”‚    128+    â”‚  40 hours    â”‚   93-96%    â”‚ Research    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

System Configuration (config/system_config.yaml):
â”œâ”€ Architecture parameters (input shapes, classes)
â”œâ”€ Training parameters (learning rate, batch size)
â”œâ”€ Augmentation settings
â”œâ”€ Inference thresholds
â””â”€ Path configurations


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DEPLOYMENT OPTIONS                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Local Inference:
   python inference_pipeline.py --image microscopy.png

2. Batch Processing:
   python -c "from inference_pipeline import batch_process_images; ..."

3. REST API (future):
   Flask/FastAPI endpoint wrapping InferencePipeline

4. Docker Container:
   Dockerfile with TensorFlow + dependencies

5. Cloud Deployment:
   TensorFlow Serving / SageMaker / Vertex AI


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          KEY FILES REFERENCE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Core Implementation:
â”œâ”€ blood_cell_system.py (26KB)
â”‚  â”œâ”€ Reynolds Networks components
â”‚  â”œâ”€ Stain normalization
â”‚  â”œâ”€ Domain adaptation
â”‚  â”œâ”€ All 3 model architectures
â”‚  â””â”€ BloodCellAnalysisSystem class
â”‚
â”œâ”€ training_pipeline.py (23KB)
â”‚  â”œâ”€ DatasetHandler
â”‚  â”œâ”€ TrainingPipeline
â”‚  â”œâ”€ Data generators
â”‚  â””â”€ Custom callbacks
â”‚
â””â”€ inference_pipeline.py (24KB)
   â”œâ”€ CellExtractor
   â”œâ”€ InferencePipeline
   â”œâ”€ DiagnosticReport
   â””â”€ Batch processing

Data Preparation:
â””â”€ prepare_segmentation_data.py
   â”œâ”€ XML annotation parser
   â”œâ”€ Mask generation
   â””â”€ Augmentation pipeline

Utilities & Examples:
â”œâ”€ example_usage.py (6 examples)
â”œâ”€ cli.py (command-line interface)
â””â”€ setup.py (environment setup)

Configuration:
â”œâ”€ config/system_config.yaml
â””â”€ config/training_presets.yaml

Documentation:
â”œâ”€ README.md (overview)
â”œâ”€ README_SYSTEM.md (technical docs)
â”œâ”€ SEGMENTATION_GUIDE.md (training guide)
â”œâ”€ DATASET_DOWNLOAD_INSTRUCTIONS.md
â””â”€ ARCHITECTURE_DIAGRAM.md (this file)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              LEGEND                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Symbols:
â”œâ”€ â”€â”€â–º : Data flow direction
â”œâ”€ â–¼   : Vertical flow
â”œâ”€ â—„â”€â”€ : Conditional/feedback flow
â”œâ”€ â”œâ”€  : Tree/hierarchical structure
â””â”€ â””â”€  : End of branch

Components:
â”œâ”€ â”Œâ”€â” : Processing blocks
â”œâ”€ â”‚ â”‚ : Container/module
â””â”€ â””â”€â”˜ : End of container

Data Types:
â”œâ”€ (batch, H, W, C) : 4D tensor (images)
â”œâ”€ (batch, n, d)    : 3D tensor (features)
â”œâ”€ (batch, d)       : 2D tensor (vectors)
â””â”€ List[Type]       : Python list of type


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THEORETICAL FOUNDATION                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Reynolds Networks (Theorem 3):
"For any continuous, permutation-invariant function f on sets, the cyclic
transposition approximation converges to the true permutation-invariant
function as the set size increases, with complexity O(n) instead of O(n!)."

Implications:
âœ“ Permutation invariance: f({xâ‚, xâ‚‚, xâ‚ƒ}) = f({xâ‚ƒ, xâ‚, xâ‚‚})
âœ“ Set operations: Can process variable-sized inputs
âœ“ Efficiency: Linear complexity enables real-time processing
âœ“ Biological validity: Cells have no inherent ordering

Domain Adaptation:
"Learn features that maximize classification accuracy while minimizing
domain discriminability, enabling cross-staining generalization."

Benefits:
âœ“ Single model works across multiple staining protocols
âœ“ No retraining needed for new labs/equipment
âœ“ Improved robustness to color variations
âœ“ Better generalization to unseen data
```

---

**Document Version**: 1.0  
**Last Updated**: November 25, 2025  
**Author**: Blood Cell Analysis System Team  
**License**: MIT
